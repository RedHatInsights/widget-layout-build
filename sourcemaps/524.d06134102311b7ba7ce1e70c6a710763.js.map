{"version":3,"file":"js/524.b8980be1ae9c5d519374.js","mappings":"y1DAiFA,QAlEqB,SAACA,GACpB,IAAMC,GAAiB,IAAAC,cAAa,KAC9BC,GAAgB,IAAAD,cAAa,MAC7BE,GAAqB,UACrBC,GAAmB,IAAAC,YAAW,KAC5BC,GAAgB,SAAgB,YAChCC,GAAwB,SAAW,oBA+C3C,OA1BA,IAAAC,YAAU,WACHF,GAIgB,mC,0DACH,UAAM,W,cAAhBG,EAAU,UAGS,GAAMC,OAAOC,QAAQF,GAASG,QAAO,SAAOC,EAAK,G,IAACC,EAAG,KAAEC,EAAK,K,sGAC7D,SAAMF,G,cAApBG,EAAc,UACdC,EAAeF,EAAMG,SACYD,EAAaE,YAAc,IA/B1CA,EA+BiEF,EAAaE,YA/B/C,gBAAGC,SAAO,W,kDAC7C,SAAMA,QAAQC,IACtCF,EAAYG,KAAI,SAAOC,GAAU,0C,yFAErBC,EAAiBD,EAAU,OAAnBE,EAASF,EAAU,KAC/BhB,EAAoBiB,IAAkD,mBAAhCjB,EAAoBiB,GAClC,GAAOjB,EAAoBiB,GAAO,MAA3BjB,EAA6EkB,GAAQ,KADpH,M,OAEF,MAAO,CAAP,EAD0B,U,OAG5B,MAAO,CAAP,GAAO,G,OAGP,O,WADAC,QAAQC,MAAM,6BAA8B,GACrC,CAAP,GAAO,G,oCAIb,MAAO,CAAP,EAf0B,SAeDC,MAAMC,U,SAeF,M,cAA2C,W,aAAmD,K,iBAIrH,OAJuB,IAErBb,EAAYF,GAAOC,GAEd,CAAP,EAAOF,GAnCU,IAAOM,C,SAoCvBC,QAAQU,QAAQ,CAAC,KATlB,M,OACIC,EAAiB,SAUvB3B,EAAiB2B,G,iCAKvB,GAAG,CAACzB,IAGF,yBAAK0B,UAAU,gBACb,kBAAC,IAAM,CAAC9B,cAAeA,EAAeC,mBAAoBA,IAC1D,kBAAC,IAAM,MACP,kBAAC,IAAe,CAAC8B,aAAa,GAC5B,kBAAC,EAAAC,YAAW,CAACF,UAAU,mEACrB,kBAAC,IAAU,GAAChC,eAAgBA,GAAoBD,MAK1D,C","sources":["webpack:///./src/Routes/Default/Default.tsx"],"sourcesContent":["import { PageSection } from '@patternfly/react-core';\nimport AddWidgetDrawer from '../../Components/WidgetDrawer/WidgetDrawer';\nimport GridLayout from '../../Components/DnDLayout/GridLayout';\nimport { useAtomValue, useSetAtom } from 'jotai';\nimport { lockedLayoutAtom } from '../../state/lockedLayoutAtom';\nimport { notificationsAtom, useRemoveNotification } from '../../state/notificationsAtom';\nimport Header from '../../Components/Header/Header';\nimport React, { useEffect } from 'react';\nimport useCurrentUser from '../../hooks/useCurrentUser';\nimport { LayoutTypes, WidgetPermission, getWidgetMapping } from '../../api/dashboard-templates';\nimport { widgetMappingAtom } from '../../state/widgetMappingAtom';\nimport '../../App.scss';\nimport Portal from '@redhat-cloud-services/frontend-components-notifications/Portal';\nimport useChrome from '@redhat-cloud-services/frontend-components/useChrome';\n\nconst DefaultRoute = (props: { layoutType?: LayoutTypes }) => {\n  const isLayoutLocked = useAtomValue(lockedLayoutAtom);\n  const notifications = useAtomValue(notificationsAtom);\n  const removeNotification = useRemoveNotification();\n  const setWidgetMapping = useSetAtom(widgetMappingAtom);\n  const { currentUser } = useCurrentUser();\n  const { visibilityFunctions } = useChrome();\n\n  const checkPermissions = async (permissions: WidgetPermission[]): Promise<boolean> => {\n    const permissionResults = await Promise.all(\n      permissions.map(async (permission) => {\n        try {\n          const { method, args } = permission;\n          if (visibilityFunctions[method] && typeof visibilityFunctions[method] === 'function') {\n            const permissionGranted = await (visibilityFunctions[method] as (...args: unknown[]) => Promise<boolean>)(...(args || []));\n            return permissionGranted;\n          }\n          return true;\n        } catch (error) {\n          console.error('Error checking permissions', error);\n          return false;\n        }\n      })\n    );\n    return permissionResults.every(Boolean);\n  };\n\n  useEffect(() => {\n    if (!currentUser) {\n      return;\n    }\n\n    const getWidgetMap = async () => {\n      const mapping = await getWidgetMapping();\n\n      if (mapping) {\n        const checkedMapping = await Object.entries(mapping).reduce(async (acc, [key, value]) => {\n          const resolvedAcc = await acc;\n          const widgetConfig = value.config;\n          const hasPermissions = widgetConfig && widgetConfig.permissions ? await checkPermissions(widgetConfig.permissions) : true;\n          if (hasPermissions) {\n            resolvedAcc[key] = value;\n          }\n          return acc;\n        }, Promise.resolve({} as Record<string, (typeof mapping)[string]>));\n\n        setWidgetMapping(checkedMapping);\n      }\n    };\n\n    getWidgetMap();\n  }, [currentUser]);\n\n  return (\n    <div className=\"widgetLayout\">\n      <Portal notifications={notifications} removeNotification={removeNotification} />\n      <Header />\n      <AddWidgetDrawer dismissible={false}>\n        <PageSection className=\"widg-c-page__main-section--grid pf-v5-u-p-md pf-v5-u-p-lg-on-sm\">\n          <GridLayout isLayoutLocked={isLayoutLocked} {...props} />\n        </PageSection>\n      </AddWidgetDrawer>\n    </div>\n  );\n};\n\nexport default DefaultRoute;\n"],"names":["props","isLayoutLocked","useAtomValue","notifications","removeNotification","setWidgetMapping","useSetAtom","currentUser","visibilityFunctions","useEffect","mapping","Object","entries","reduce","acc","key","value","resolvedAcc","widgetConfig","config","permissions","Promise","all","map","permission","method","args","console","error","every","Boolean","resolve","checkedMapping","className","dismissible","PageSection"],"sourceRoot":""}